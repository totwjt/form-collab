# Form-Collab 开发指南

## 开发环境设置
1. 确保安装了正确的 Node.js 版本（>=16.0.0）
2. 使用 pnpm 作为包管理器
3. 安装依赖：`pnpm install`

## 开发流程
1. 启动开发服务器
   ```bash
   pnpm start
   ```
   这会同时启动：
   - WebSocket 服务器（packages/server）
   - 演示应用（apps/demo）

2. 开发新功能
   - 在 core 包中实现核心逻辑
   - 在 vue 包中实现组件
   - 在 server 包中实现服务器逻辑

3. 构建
   ```bash
   pnpm build
   ```

## 代码规范

### 目录结构
- 每个模块都应该有自己的目录
- 相关的类型定义放在 types 目录
- 工具函数放在 utils 目录

### 命名规范
- 文件名：使用 kebab-case（例如：`user-store.ts`）
- 类名：使用 PascalCase（例如：`WebSocketClient`）
- 接口名：使用 PascalCase，以 I 开头（例如：`IFormState`）
- 类型名：使用 PascalCase（例如：`FormMessage`）
- 变量名：使用 camelCase（例如：`messageQueue`）

### 类型定义
- 所有类型都应该在 types 目录中定义
- 避免使用 any 类型
- 使用接口定义对象结构
- 使用类型别名定义联合类型

### 模块导出
- 使用 index.ts 作为模块入口
- 明确导出需要的类型和函数
- 避免导出内部实现细节

## 最佳实践

### 状态管理
1. 使用不可变数据结构
2. 实现乐观更新
3. 处理并发冲突
4. 保持状态同步

### WebSocket 通信
1. 实现重连机制
2. 使用消息队列
3. 处理连接状态
4. 实现心跳检测

### 错误处理
1. 使用 try-catch 捕获异常
2. 实现错误恢复机制
3. 提供用户友好的错误提示
4. 记录错误日志

### 性能优化
1. 避免不必要的重渲染
2. 使用防抖和节流
3. 优化 WebSocket 消息大小
4. 实现数据缓存

## 测试
1. 单元测试
   - 测试核心业务逻辑
   - 测试工具函数
   - 测试类型定义

2. 集成测试
   - 测试模块间交互
   - 测试 WebSocket 通信
   - 测试状态同步

3. 端到端测试
   - 测试用户界面
   - 测试协同编辑功能
   - 测试错误处理

## 文档
1. 代码注释
   - 使用 JSDoc 注释
   - 说明函数用途和参数
   - 说明类型定义

2. 项目文档
   - 更新 README.md
   - 维护 CHANGELOG.md
   - 编写使用示例

## 发布流程
1. 更新版本号
2. 更新 CHANGELOG.md
3. 运行测试
4. 构建项目
5. 发布到 npm